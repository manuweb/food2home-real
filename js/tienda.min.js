/**
 * Archivo: tienda.min.js
 *
 * Version: 1.0.7
 * Fecha  : 30/01/2024
 *
 * © Manuel Sánchez (www.elmaestroweb.es)
 *
*/

function muestraproductoinicio(e){var t=0;null!=localStorage.getItem("tiendaSeleccionada")&&(t=desencripta(localStorage.getItem("tiendaSeleccionada")));var a=servidor+"includes/leeproductossearch.php";$.ajax({type:"POST",url:a,data:{isapp:isApp,id:e,tienda:t},dataType:"json",success:function(e){var t=Object(e);if(!0==t.valid){var a=t.id[0],o=t.nombre[0];t.precio_web[0],isApp&&t.precio_app[0];var i=t.cat_id[0],r=t.gru_id[0],s=t.cat_nombre[0],d=t.gru_nombre[0],l=t.modifier_category_id[0];t.modifier_group_id[0],muestraelproducto(a,o,r,d,i,s,l,t.iva[0])}else muestraMensaje("No se pudo leer los productos",titulo="",subtitulo="Error")},error:function(e,t,a){console.log(e.status),console.log(a)}})}function muestraproductossearch(){var e=0;null!=localStorage.getItem("tiendaSeleccionada")&&(e=desencripta(localStorage.getItem("tiendaSeleccionada")));var t=servidor+"includes/leeproductossearch.php";$.ajax({type:"POST",url:t,data:{isapp:isApp,tienda:e},dataType:"json",success:function(e){var t=Object(e);if(!0==t.valid){var a=t.id,o=t.nombre;t.precio_web,isApp&&t.precio_app;var i=t.cat_id,r=t.gru_id,s=t.cat_nombre,d=t.gru_nombre,l=t.modifier_category_id;t.modifier_group_id;var c=t.iva,n="<ul>";for(x=0;x<o.length;x++)n+='<li class="item-content"><div class="item-inner"><div class="item-title" onclick="muestraproductoelegido(\''+a[x]+"','"+o[x]+"','"+r[x]+"','"+d[x]+"','"+i[x]+"','"+s[x]+"','"+l[x]+"','"+c[x]+"');\">"+o[x]+"</div></div></li>";n+="</ul>",$("#lista-productos").html(n)}else muestraMensaje("No se pudo leer los productos",titulo="",subtitulo="Error")},error:function(e,t,a){console.log(e.status),console.log(a)}})}function muestraproductoelegido(e,t,a,o,i,r,s,d){app.searchbar.toggle(),muestraelproducto(e,t,a,o,i,r,s,d)}var txt_sel_tienda="";function muestragrupos(){$(".toolbar-bottom").show(),localStorage.getItem("miLat");var e="";if(tiendas.length>1){txt_sel_tienda='<div class="block-title">Seleccione tu <b>'+app.name+'</b></div><div class="list list-outline-ios list-strong-ios list-dividers-ios media-list"><ul>';var t=0;for(x=0;x<tiendas.length;x++)t=calcularDistanciaEntreDosCoordenadas(tiendas[x].lat,tiendas[x].lng,localStorage.getItem("miPosLat"),localStorage.getItem("miPosLng")).toFixed(2),tiendas[x].distancia=t;for(x=0,tiendas=tiendas.sort(function(e,t){return e.distancia===t.distancia?0:e.distancia<t.distancia?1:-1});x<tiendas.length;x++)txt_sel_tienda+='<li><div class="item-content" onclick="seleccionaTienda('+tiendas[x].id+')"><div class="item-media"><img style="border-radius: 8px" src="img/icon.png" width="40" /></div><div class="item-inner"><div class="item-title-row"><div class="item-title" style="color:'+colorsecundario+';">'+tiendas[x].alias+'</div><div class="item-after" style="font-size: 14px;"> <i class="icon f7-icons size-14" style="top: 3px;">location_fill</i> '+tiendas[x].distancia+' Km</div></div><div class="item-subtitle">'+tiendas[x].domicilio+"</div></div></div></li>";if(txt_sel_tienda+="</ul></div>",null===localStorage.getItem("tiendaSeleccionada")){$("#catalog-page").html(txt_sel_tienda);return}var a=desencripta(localStorage.getItem("tiendaSeleccionada")),o=tiendas.map(e=>e.id).indexOf(a);e='<div id="seleccion-tienda"><div class="block-title block-title-medium">Tu <span style="color:'+colorprimario+';"><b>'+app.name+"</b></span>:</div>",e+='<div class="list list-outline-ios list-strong-ios list-dividers-ios media-list" style="margin-bottom: 12px;"><ul><li><a class="item-link item-content" onclick="cambiaTienda();">',e+='<div class="item-media"><img style="border-radius: 8px" src="img/icon.png" width="40" /></div><div class="item-inner"><div class="item-title-row"><div class="item-title" style="color:'+colorsecundario+';">'+tiendas[o].alias+'</div></div><div class="item-subtitle">'+tiendas[o].domicilio+"</div></div></a></li>",e+="</ul></div></div>"}var i=0;null!=localStorage.getItem("tiendaSeleccionada")&&(i=desencripta(localStorage.getItem("tiendaSeleccionada"))),muestraproductossearch();var r=servidor+"includes/leegrupo.php";$.ajax({type:"POST",url:r,data:{id:"",isapp:isApp,colorprimario:colorprimario,tienda:i},dataType:"json",success:function(t){var a=Object(t);if(!0==a.valid){a.id,a.nombre,a.imagen;var o=a.texto;a.imagen_app,columna=0,app.searchbar.create({el:".searchbar",searchContainer:"#lista-productos",searchIn:".item-title",on:{search(e,t,a){},disable(){$("#lista-productos").hide(),$("#no-encontrado").hide()}}}),$("#catalog-page").html(e+o),$("#catalog-page").show(),$("#buy-page").hide(),$("#icon-back").hide(),$("#titulo-menus").html("Men\xfas"),destacadosinicio("catalog-page","catalogo")}else muestraMensaje("No se pudo leer el grupo de productos",titulo="",subtitulo="Error")},error:function(e,t,a){console.log(e.status),console.log(a)}})}function seleccionaTienda(e){localStorage.setItem("tiendaSeleccionada",encripta(e)),muestragrupos()}function cambiaTienda(){$("#seleccion-tienda").html(txt_sel_tienda)}function muestracategorias(e,t){$(".toolbar-bottom").show();var a=0;null!=localStorage.getItem("tiendaSeleccionada")&&(a=desencripta(localStorage.getItem("tiendaSeleccionada")));var o=servidor+"includes/leecategorias.php";$.ajax({type:"POST",url:o,data:{grupo:e,nombregrupo:t,isapp:isApp,colorprimario:colorprimario,tienda:a},dataType:"json",success:function(a){var o=Object(a);if(!0==o.valid){o.id,o.nombre,o.imagen,o.imagen_app;var i=o.texto,r='<p><span style="font-size:1.2em;"><a href="javascript:muestragrupos();" class="item-link">'+nameBreadcum+"</a> / "+t.charAt(0).toUpperCase()+t.slice(1).toLocaleLowerCase()+"</span></p>";0==breadcrumbs&&(r=""),$("#titulo-menus").html(t),$("#icon-back").show(),document.getElementById("link-volver").href="javascript:muestragrupos();",$("#catalog-page").html(r+i),destacadosinicio("catalog-page","catalogo"),1==o.id.length&&muestraproductos(e,t,o.id[0],o.nombre[0],1)}else muestraMensaje("No se pudo leer el grupo de productos",titulo="",subtitulo="Error")},error:function(e){console.log("error")}})}function muestraproductos(e,t,a,o,i=0){$(".toolbar-bottom").show();var r=0;null!=localStorage.getItem("tiendaSeleccionada")&&(r=desencripta(localStorage.getItem("tiendaSeleccionada")));var s=servidor+"includes/leeproductos.php";$.ajax({type:"POST",url:s,data:{idcategoria:a,isapp:isApp,idgrupo:e,nombregrupo:t,nombrecategoria:o,colorprimario:colorprimario,tienda:r},dataType:"json",success:function(a){var r=Object(a);if(!0==r.valid){r.id,r.nombre,r.precio_web,isApp&&r.precio_app,r.modifier_category_id,r.modifi,r.modifier_group_id,r.iva,r.imagen,r.imagen_app1;var s=r.texto,d=r.totCategorias,l='<p><span style="font-size:1.2em;"><a href="javascript:muestragrupos();" class="item-link">'+nameBreadcum+"</a> / <a href=\"javascript:muestracategorias('"+e+"','"+t+'\');" class="item-link">'+t.charAt(0).toUpperCase()+t.slice(1).toLocaleLowerCase()+"</a> / "+o.charAt(0).toUpperCase()+o.slice(1).toLocaleLowerCase()+"</span></p>";0==breadcrumbs&&(l=""),$("#catalog-page").html(l+s),$("#titulo-menus").html(o),$("#icon-back").show(),document.getElementById("link-volver").href='javascript:muestracategorias("'+e+'","'+t+'");',(1==i||1==d)&&(document.getElementById("link-volver").href="javascript:muestragrupos();")}else console.log(r),muestraMensaje("No se pudo leer los productos",titulo="",subtitulo="Error")},error:function(e,t,a){console.log(e.status),console.log(a)}})}function muestraelproducto(e,t,a,o,i,r,s="",d){var l=0;null!=localStorage.getItem("tiendaSeleccionada")&&(l=desencripta(localStorage.getItem("tiendaSeleccionada")));var c=servidor+"includes/leeproducto.php";$.ajax({type:"POST",url:c,data:{id:e,idgrupo:a,nombregrupo:o,idcategoria:i,nombrecategoria:r,anchopantalla:screen.width,isapp:isApp,colorprimario:colorprimario,colorsecundario:colorsecundario,tienda:l},dataType:"json",success:function(t){var s=Object(t);if(!0==s.valid){s.imagen;var d=s.texto,l=s.modifierCategories;s.modifiers;var c=s.modifi,n=s.precio;s.background,s.link_volver;var u=s.txt_aler,m=s.esMenu;app.tab.show("#view-producto"),$("#pagina-producto").html(d),document.getElementById("link-volver-producto").href='javascript:app.tab.show("#view-catalog");muestraproductos("'+a+'","'+o+'",'+i+',"'+r+'");',app.tooltip.create({targetEl:".tip-alergenos",text:u}),$(".tabbar-icons").hide(),null!=l?("1"==c&&(l=[],document.getElementById("add-to-cart").setAttribute("data-modificadores","{&quot;forzoso&quot;:&quot;0&quot;}")),cambiamodificador(n,l.length,e)):($("#add-to-cart").removeClass("button-fill"),$("#add-to-cart").removeClass("disabled"),$("#add-to-cart").removeClass("color-white"),$("#add-to-cart").addClass("button-fill"),$("#stepper-producto").show()),carrito.length>0&&($(".badage-cart").show(),$(".badage-cart").html(totalItemCarrito)),1==m&&($("#stepper-producto").hide(),$("#add-to-cart").removeClass("button-fill"),$("#add-to-cart").addClass("disabled"))}else muestraMensaje("No se pudo leer el producto",titulo="",subtitulo="Error")},error:function(e,t,a){console.log(e.status),console.log(a)}})}var getBackgroundImageSize=function(e){var t=$(e).css("background-image").match(/^url\(["']?(.+?)["']?\)$/),a=new $.Deferred;if(t){var o=new Image;o.onload=a.resolve,o.onerror=a.reject,o.src=t[1]}else a.reject();return a.then(function(){return{width:this.width,height:this.height}})};function miraMaximoElegible(e,t){var a=$("#opciones-multiples-"+e+" :selected").length;if(t>0&&a>t){document.getElementById("opciones-multiples-"+e).options;var o=app.smartSelect.get("#smart-multiples-"+e);muestraMensaje("Elija m\xe1ximo "+t+" opciones",titulo="",subtitulo="Por favor"),o.unsetValue(),o.close(),$("#item-after-multiples-"+e).remove(),$("#item-title-multiples-"+e).after('<div  class="item-after" id="item-after-multiples-'+e+'"></div>')}}function muestramodificador(e,t){if("1"==$("#but-mod-"+t).attr("data-forzoso")){var a=$("#from-producto input[name=forzoso]").val();$("#from-producto input[name=forzoso]").val(a-1)}$("#but-mod-"+t).html('<i class="icon f7-icons size-22" style="    float: right;color: '+colorprimario+';font-weight:800;">checkmark</i>'),JSON.parse(JSON.stringify(app.form.convertToData("#from-producto"))),"0"==$("#from-producto input[name=forzoso]").val()&&($("#add-to-cart").removeClass("button-fill"),$("#add-to-cart").removeClass("disabled"),$("#add-to-cart").removeClass("color-white"),$("#add-to-cart").addClass("button-fill"),$("#stepper-producto").show())}function cambiamodificador(e,t,a){var o="",i=1;""!=$("#cantidadProducto").html()&&(i=parseInt($("#cantidadProducto").html()));var r=0,s=JSON.parse(JSON.stringify(app.form.convertToData("#from-producto")));for(x=0;x<t;x++){var d=s["tipo_"+x];if(Array.isArray(d))for(j=0;j<d.length;j++){var l=d[j].split("#");r+=parseFloat(l[1]),o+=l+"-"}else if(void 0!=d){var l=d.split("#");r+=parseFloat(l[1]),o+=l+"-",$("#tipo_"+x).html(l[2])}}o=o.slice(0,-1);var c=i*(parseFloat(e)+r);$("#precio-producto").html(c.toFixed(2)+"€"),document.getElementById("add-to-cart").setAttribute("data-id",a),document.getElementById("add-to-cart").setAttribute("data-precio",(parseFloat(e)+r).toFixed(2)),document.getElementById("add-to-cart").setAttribute("data-modificadores",JSON.stringify(app.form.convertToData("#from-producto")))}function SumaUno(){var e=parseInt($("#cantidadProducto").val()),t=$("#precio-producto").html().split("€"),a=parseFloat(t)/e;e<98&&($("#cantidadProducto").val(e+1),$("#precio-producto").html(((e+1)*a).toFixed(2)+"€"))}function RestaUno(){var e=parseInt($("#cantidadProducto").val()),t=$("#precio-producto").html().split("€"),a=parseFloat(t)/e;e>1&&($("#cantidadProducto").val(e-1),$("#precio-producto").html(((e-1)*a).toFixed(2)+"€"))}function addCarritodesdeproducto(e){var t=$("#comentario-prod").val(),a=parseInt($("#cantidadProducto").val()),o=$("#add-to-cart").attr("data-modificadores");let i=JSON.parse(o);delete i.forzoso,o=JSON.stringify(i),$("#add-to-cart").attr("data-modificadores",o),addCarrito(e,a,t),$("#cantidadProducto").val("1")}function evaluatextomsgprod(){$("#caracteres").css("color",colorprimario);var e=document.getElementById("comentario-prod").value;document.getElementById("caracteres").innerHTML=140-e.length,e.length>140&&(document.getElementById("comentario-prod").value=e.substring(0,e.length-1),document.getElementById("caracteres").innerHTML="0")}


