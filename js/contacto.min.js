/**
 * Archivo: contacto.min.js
 *
 * Version: 1.0.0
 * Fecha  : 02/10/2023
 *
 * © Manuel Sánchez (www.elmaestroweb.es)
 *
*/


function contactar() {  
    var dynamicPopup = app.popup.create({
        content: ''+
          '<div class="popup">'+
            '<div class="block page-content">'+
              '<p class="text-align-left"><a href="#" class="link popup-close "><i class="icon f7-icons ">xmark</i></a></p>'+
            '<div class="block-title">Contactar</div>'+       
            '<form class="list" id="contact-form" enctype="multipart/form-data">'+
                '<ul>'+
                    '<li>'+
                        '<div class="item-content item-input">'+
                            '<div class="item-inner">'+
                                '<div class="item-title item-label">Nombre</div>'+
                                '<div class="item-input-wrap">'+
                                    '<input type="text" name="nombre" placeholder="Nombre" required validate/>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                    '</li>'+
                    '<li>'+
                        '<div class="item-content item-input">'+
                            '<div class="item-inner">'+
                                '<div class="item-title item-label">Email</div>'+
                                '<div class="item-input-wrap">'+
                                    '<input type="email" name="email" placeholder="Email" required validate />'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                    '</li>'+
                    '<li>'+
                        '<div class="item-content item-input">'+
                            '<div class="item-inner">'+
                                '<div class="item-title item-label">Teléfono</div>'+
                                '<div class="item-input-wrap">'+
                                    '<input type="tel" name="telefono" placeholder="Teléfono" required validate/>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                    '</li>'+
                    '<li>'+
                        '<div class="item-content item-input">'+
                            '<div class="item-inner">'+
                                '<div class="item-title item-label">Comentario</div>'+
                                '<div class="item-input-wrap">'+
                                    '<textarea name="comentario" required validate></textarea>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                    '</li>'+
                    '<li>'+
                       ' <label class="item-checkbox item-content">'+
                            '<input type="checkbox" name="privacidad-contacto-checkbox" id="id-politicas-contacto"/>'+
                                '<i class="icon icon-checkbox"></i>'+
                               ' <div class="item-inner">'+
                                '<div class="item-title" style="font-size:.8em;">Acepto la <a href="#" class="link" onclick="leePolitica();">Política de privacidad</a>.</div>'+
                                '</div>'+
                        '</label>'+
                    '</li>'+
                '</ul>'+
            '</form>'+
        
                '<div class="block block-strong grid grid-cols-2 grid-gap">'+
                    '<div class=""><button class="button button-fill button-round text-align-center button secundario-BG popup-close" style="width:80%; margin:auto;">Cancelar</button></div>'+
                    '<div class=""><button class="button button-fill button-round text-align-center save-data" style="width:80%; margin:auto;" disabled>Enviar</button</div>'+
                '</div>'+
         
            '</div>'+
          '</div>'
         ,
        // Events
        on: {
          open: function (popup) {
              $('.secundario-BG').css('background-color',colorsecundario);
              },
          opened: function (popup) {
            //console.log('Popup opened');
          },
        }
    });  
    
    dynamicPopup.on('close', function (popup) {
        //console.log('Popup close');
      });
      dynamicPopup.on('closed', function (popup) {
        //console.log('Popup closed');
          
      });
    dynamicPopup.open();
    
    $('#id-politicas-contacto').change(function() {
        
        if($('#id-politicas-contacto').is(':checked') ){
            $('.save-data').prop( "disabled", false );
        }
        else {
            $('.save-data').prop( "disabled", true );;
        }
    });
    $('.save-data').on('click', function(){
        var errores='';
        if ($('#contact-form input[name*="nombre"]').val()==''){
            errores+='Nombre,';
        }
        if ($('#contact-form input[name*="email"]').val()==''){
            errores+=' Email,';
        }
        if ($('#contact-form input[name*="telefono"]').val()==''){
            errores+=' Teléfono,';
        }
        if ($('#contact-form textarea[name*="comentario"]').val()==''){
            errores+=' Comentario';
        }
        if (errores!=''){
            app.dialog.alert('Debe completar:<br><br>'+errores)
            return;
        }
        
        $.ajax({
            type: "POST",
            url: servidor+'includes/envioemail.php',
            dataType:"json",
            data:{nombre:$('#contact-form input[name*="nombre"]').val(),email:$('#contact-form input[name*="email"]').val(),telefono:$('#contact-form input[name*="telefono"]').val(),comentario:$('#contact-form textarea[name*="comentario"]').val(),tipo:'contacto'},
            success: function(data){
                var obj=Object(data);
                if (obj.valid==true){
                    muestraMensaje('Formulario de contaxto enviado',titulo='');
                }
                else {
                    muestraMensaje('Error enviando el formulario',titulo='Error');
                }
            },
            error: function (xhr, ajaxOptions, thrownError){
                console.log(xhr.status);
                console.log(thrownError);
            }
        });
            
        dynamicPopup.close();
    });
}


