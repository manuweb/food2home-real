/**
 * Archivo: comprar-menus.js
 *
 * Version: 1.0.0
 * Fecha  : 14/04/2023
 *
 * © Manuel Sánchez (www.elmaestroweb.es)
 *
*/
var elemMenu=new Array();

function cambiaMenu(id,eleMulti,min,max,nombre,idProd,nomProd){
    var tienda=0;
    if (localStorage.getItem("tiendaSeleccionada") != null) {
        tienda=desencripta(localStorage.getItem("tiendaSeleccionada"));
    }
    elemMenu['idProducto']=idProd; 
    elemMenu['nombreProducto']=nomProd; 
    var server=servidor+'includes/leeproductosMenu.php';
    $.ajax({
        url: server,
        data:{id:id,isapp:isApp, eleMulti:eleMulti,min:min, max:max,nombre:nombre,tienda:tienda},
        method: "post",
        dataType:"json",
        success: function(data){    
            var obj=Object(data);
            if (obj.valid==true){
               //$json=array("valid"=>$checking,"producto"=>$producto,"precio"=>$precio,"modifier_group_id"=>$modifier_group_id,"addPrecioMod"=>$addPrecioMod);

                var producto=obj.producto;
                var nombre=obj.nombre;
                var precio=obj.precio;
                var modifier_group_id=obj.modifier_group_id;
                var addPrecioMod=obj.addPrecioMod;
                var txt_pre=obj.txt_pre;
                var txt=obj.txt;
                //$('#tipo_menu_'+id).html(txt);
                $('.swiper').hide();
                $('.title-swiper').hide();
                $('#title-swiper-menu-'+id).html(txt_pre);
                $('#title-swiper-menu-'+id).show();

                
                $('#swiper-menu-'+id).html(txt);
                $('#swiper-'+id).show();
                app.swiper.create('.swiper', {
					allowTouchMove:true,
					pagination: {
						  el: '.swiper-pagination',
						  type: 'bullets',
                            
						},
                    spaceBetween: 10,
					}
				);
                /*
                app.stepper.create({
                    el: '.stepper',
  
                });
                */
                if ((eleMulti==3)||(eleMulti==4)){
                    if ($('#item-after-'+id).html()!=''){
                        var temp=elemMenu[id];
                        for (j=0;j<temp.length;j++){
                            //console.log(temp[j].nombreproducto)
                            
                            $('#prod-menu-'+temp[j].idproducto).val(temp[j].cantidad);
                            
 
                            
                        }
                    }
                }
                else {
                    if (eleMulti==0){
                        if ($('#item-after-'+id).html()!=''){
                            
                            var elegido=$('#item-after-'+id).html();
                            var nom='chk-ele-multi-'+id;
                            //console.log(nom+' - '+elegido);
                            // chk-ele-multi-
                            
                            $("input[name="+nom+"][value='" + elegido + "']").prop('checked', true);
                        }
                        
                    }
                    if (eleMulti==1){
                        if ($('#item-after-'+id).html()!=''){
                            var temp=elemMenu[id];
                            for (j=0;j<temp.length;j++){
                                //console.log(temp[j].nombreproducto)

                                $('#prod-menu-'+temp[j].idproducto).val(temp[j].cantidad);

                            }
                        }
                        
                    }
                    
                }
                $('.button-menu').hide();
                $('#button-menu-'+id).show();
                
                
            }
            else {
                console.log('error');
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            console.log(xhr.status);
            console.log(thrownError);
        }
    });
}

function cambiaSeleccionMenu(nom,prod,id, imagen, precio,iva){
    //console.log(nom+' - '+prod);
    $('#title-swiper-menu-'+id).hide();
    $('#swiper-'+id).hide();
    $('#icon_menu_'+id).html('checkmark_circle_fill');
    $('#icon_menu_'+id).removeClass('text-color-red');
    $('#icon_menu_'+id).addClass('text-color-green');
    $('#item-after-'+id).html(nom);
    $('#input-menu-'+id).val(id+'-si');
    //var precio_a_sumar=precio;
    elemMenu[id]={'idproducto':prod,'nombreproducto':nom, 'cantidad':1,'iva':iva,'precio':precio,'imagen':imagen}; 
    
    //console.log(elemMenu['nombreProducto']);
    
    var precio_a_sumar=cambiapreciosMenu();
    compruebaMenuChk();
    
}

function cambiapreciosMenu() {
    var su_precio=parseFloat($('#add-to-cart').attr('data-precio'));
    
    
    var nuevo_precio=0;
    //$("#precio-producto").html(nuevo_precio.toFixed(2)+"€");
    //console.log('muevo precio:'+nuevo_precio);
    
    
    var precio_a_sumar=0;
    //console.log(elemMenu);
    var cantidad=parseInt($('#cantidadProducto').val()); 
    $('.input-menu-'+$('#add-to-cart').attr('data-id')).each(function(){
        var myArray = $(this).val().split("-");
        if (myArray[1]=='si'){
            if (Array.isArray(elemMenu[myArray[0]])){
                for(j=0;j<elemMenu[myArray[0]].length;j++){
                    precio_a_sumar+=(parseFloat(elemMenu[myArray[0]][j]['cantidad'])*parseFloat(elemMenu[myArray[0]][j]['precio']));
                }
            
            }
            else {
                precio_a_sumar+=(parseFloat(elemMenu[myArray[0]]['cantidad'])*parseFloat(elemMenu[myArray[0]]['precio']));
            }
            //console.log(precio_a_sumar);
        }

        
    });
    
    var nuevo_precio=cantidad*(su_precio+precio_a_sumar);
    $("#precio-producto").html(nuevo_precio.toFixed(2)+"€");
    return precio_a_sumar;
    
}

function compruebaMenuChk() {
    var suma=0;
    var chk=0;
    $('.icon_menu').each(function(){
        suma++;
        if ($(this).hasClass('text-color-green')){
            chk++;
        }
            
    });

    if(suma==chk){
        $('#add-to-cart').removeClass('disabled');
        $('#add-to-cart').addClass('button-fill');
        //addCarritoMenu(this);"
        document.getElementById('add-to-cart').setAttribute('onclick','addCarritoMenu(this)')
    }
}

function compruebaMenu(id,min,max) {
    var suma=0;
    $('.prod-menu-'+id).each(function(){
        suma+=parseInt($(this).val());
        
    });
    //console.log('Suma:'+suma);
    
    if (suma<min){
        app.dialog.alert('Te falta '+(min-suma)+' producto(s)');
    }
    else {
        var varios='';
        var elegidos=0;
        var precio_a_sumar=0;
        elemMenu[id]=new Array();
        $('.prod-menu-'+id).each(function(){
            
            if ($(this).val()>0){
                /*
                console.log($(this).attr('data-nombre'));
                console.log($(this).val());
                console.log($(this).attr('data-id'));
                console.log($(this).attr('data-imagen'));
                */
                //console.log($(this).attr('data-nombre'));
                varios=$(this).attr('data-nombre');
                elegidos++;
                
                elemMenu[id].push({'idproducto':parseInt($(this).attr('data-id')),'nombreproducto':$(this).attr('data-nombre'),cantidad:parseInt($(this).val()),'imagen':$(this).attr('data-imagen'), 'iva':parseInt($(this).attr('data-iva')), 'precio':parseFloat($(this).attr('data-precio'))});
                precio_a_sumar+=parseFloat($(this).attr('data-precio'));
                
            }

            $('#button-menu-'+id).hide();
            //console.log('ocultado:#button-menu-'+id);
            $('#title-swiper-menu-'+id).hide();
            $('#swiper-'+id).hide();
            $('#icon_menu_'+id).html('checkmark_circle_fill');
            $('#icon_menu_'+id).removeClass('text-color-red');
            $('#icon_menu_'+id).addClass('text-color-green');
            compruebaMenuChk();
            $('#input-menu-'+id).val(id+'-si');
            
        });
        
        var precio_a_sumar=cambiapreciosMenu();
        
        if (elegidos>1){
            varios='varios';
        }
        else {
            if (varios.length>8){
                varios =varios.substring(0, 7)+'..';
            }
        }
        
        $('#item-after-'+id).html(varios);
    }
    
    
}

function RestaUnoMenu(e,min,max,id){
    if (parseInt($('#prod-menu-'+e).val())>min){
        $('#prod-menu-'+e).val(parseInt($('#prod-menu-'+e).val())-1);
    }
    var precio_a_sumar=cambiapreciosMenu();
    
}

function SumaUnoMenu(e,min,max,id){
    
    var suma=0;
    
    $('#prod-menu-'+e+' .prod-menu-'+id).each(function(){
        console.log(parseInt($(this).val()));
        suma+=parseInt($(this).val());
        
        
    });
    console.log('suma:'+suma);
    var hay=parseInt($('#prod-menu-'+e).val());
    console.log('hay:'+$('#prod-menu-'+e).val());
    
    if ((suma>=min)&&(suma<max)){
        console.log('suma :'+suma);
        $('#prod-menu-'+e).val(hay+1);
    }
    
    //console.log($('#prod-menu-'+e).attr('data-nombre'));
    
     var precio_a_sumar=cambiapreciosMenu();
}

function veriOpcionMenu(elem){   
    var datos=elem.value.split("#");
    var chekeado=elem.checked;   
    var su_precio=parseFloat($('#add-to-cart').attr('data-precio'));
    var restar=0;
    var sumar=0;
    
    $('.elem-menu-opc-'+datos[1]).each(function(){   
        if ($(this).prop('checked')){
            restar+=parseFloat($(this).attr('data-precio'));        
        }   
    });
   
    $('.elem-menu-opc-'+datos[1]).each(function(){
        $(this).prop('checked',false);
        
    });
    
    var precio=parseFloat(datos[7]);
    if (chekeado){
        elem.checked=true;
        sumar=precio+precio;    
    }
    else {
        restar+=precio;
    }
     //console.log('restar:'+restar);
    //console.log('sumar:'+sumar);
    $('#add-to-cart').attr('data-precio',(su_precio-restar+sumar).toFixed(2));
    $('#precio-producto').html($('#add-to-cart').attr('data-precio')+' €');
    
    var elemForzoso=$('#but-mod-'+datos[1]);
    
    elemForzoso.html('<i class="icon f7-icons text-color-green icon_menu" style="float: right">checkmark_circle_fill</i>');
}


function cambiaSeleccionOpcionMenu2(elem){
    var datos=elem.value.split("#");
    var chekeado=elem.checked;   
    var su_precio=parseFloat($('#add-to-cart').attr('data-precio'));
    var restar=0;
    var sumar=0;
    $('.elem-menu-opc-'+datos[1]).each(function(){   
        if ($(this).prop('disabled')){
            restar=parseFloat($(this).attr('data-precio'));        
        }   
    });
    
    
    $('.elem-menu-opc-'+datos[1]).each(function(){   
       
            $(this).prop('disabled',false);
   
    });
    
    var precio=parseFloat(datos[7]);
    if (chekeado){
        elem.checked=true;
        elem.disabled=true;
        sumar=precio;     
    }

    $('#add-to-cart').attr('data-precio',(su_precio-restar+sumar).toFixed(2));
    $('#precio-producto').html($('#add-to-cart').attr('data-precio')+' €');
    
    var elemForzoso=$('#but-mod-'+datos[1]);
    
    elemForzoso.html('<i class="icon f7-icons text-color-green icon_menu" style="float: right">checkmark_circle_fill</i>');
    verificaCuantosPuestos();
}

function cambiaSeleccionOpcionMenu(elem){
    var forz=0;
    var datos=elem.value.split("#");
    var su_precio=parseFloat($('#add-to-cart').attr('data-precio'));
    var hay=0;
    var resta=0;
    var elemForzoso=$('#but-mod-'+datos[1]);
    var forzoso=parseInt(elemForzoso.attr('data-forzoso'));
   
    var elem=$('.elem-menu-opc-'+datos[1]+'-'+datos[2]);
    var chekeado=elem.prop('checked');
   
    var eleMulti=parseInt(datos[4]);
    
    var precio=parseFloat(datos[7]);
    
    var min=parseInt(datos[5]);
    var max=parseInt(datos[6]);
    $('.elem-menu-opc-'+datos[1]).each(function(){
        if ($(this).prop('checked')){
            hay++;
            if (eleMulti==2){
                su_precio-=precio;
                console.log('elemulti2');
                console.log('resta:'+resta);
            }
        }
    });
    
    if (chekeado){
        
        console.log('sumamos:'+precio);
        $('#add-to-cart').attr('data-precio',(su_precio+precio).toFixed(2));
        $('#precio-producto').html($('#add-to-cart').attr('data-precio')+' €');
    }
    else {
        $('#add-to-cart').attr('data-precio',(su_precio-precio).toFixed(2));
        $('#precio-producto').html($('#add-to-cart').attr('data-precio')+' €');
    }
    if (hay>max){
        elem.prop('checked',false);
        return;
    }
    var forzosos =parseInt($('input:hidden[name=forzoso]').val());
    if (hay>=min) {
        elemForzoso.html('<i class="icon f7-icons text-color-green icon_menu" style="float: right">checkmark_circle_fill</i>');
        
        
    }
    else {
        
        elemForzoso.html('<i class="icon f7-icons text-color-red icon_menu" style="float: right">xmark</i>');
       
    }

    verificaCuantosPuestos();
    
}

function resta1Menu(elem){
    var datos=elem.split("#");
    var forz=0;
    var su_precio=parseFloat($('#add-to-cart').attr('data-precio'));
    var elemForzoso=$('#but-mod-'+datos[1]);
    var forzoso=elemForzoso.attr('data-forzoso');
    // $x.'#'.$id.'#'.$producto.'#'.$nombre.'#'.$eleMulti.'#'.$min.'#'.$max.'#'.$precio.'#'.$imagen.'#'.$impuesto;
    // chk-ele-multi-
    var elem=$('.elem-menu-opc-'+datos[1]+'-'+datos[2]);
    var hay=parseInt(elem.val());
    var precio=parseFloat(datos[7]);
    var suma=0;
    var min=parseInt(datos[5]);
    var max=parseInt(datos[6]);
    $('.menu-stepper-'+datos[1]).each(function(){
        suma+=parseInt($(this).val());   
    });
    if (hay>0){
        elem.val(hay-1);
        //hay--;
        suma--;
        $('#add-to-cart').attr('data-precio',(su_precio-precio).toFixed(2));
        $('#precio-producto').html($('#add-to-cart').attr('data-precio')+' €');
    }

    if (suma>=min) {
        elemForzoso.html('<i class="icon f7-icons text-color-green icon_menu" style="float: right">checkmark_circle_fill</i>')
    }
    else {
        elemForzoso.html('<i class="icon f7-icons text-color-red icon_menu" style="float: right">xmark</i>');
       
    }
    
    verificaCuantosPuestos();
    //console.log(datos[2]);
}

function suma1Menu(elem){
    var forz=0;
    var datos=elem.split("#");
    //console.log(elem);
    var su_precio=parseFloat($('#add-to-cart').attr('data-precio'));
    // but-mod-153
    var elemForzoso=$('#but-mod-'+datos[1]);
    var forzoso=elemForzoso.attr('data-forzoso');
    
    // $x.'#'.$id.'#'.$nombre.'#'.$eleMulti.'#'.$min.'#'.$max.'#'.$precio.'#'.$imagen.'#'.$impuesto;
    
    var elem=$('.elem-menu-opc-'+datos[1]+'-'+datos[2]);
    var hay=parseInt(elem.val());
    var precio=parseFloat(datos[7]);
    var suma=0;
    var min=parseInt(datos[5]);
    var max=parseInt(datos[6]);
    $('.menu-stepper-'+datos[1]).each(function(){
        suma+=parseInt($(this).val());   
    });
    
    if (suma<max){
        elem.val(hay+1);
        //hay++;
        suma++;
        $('#add-to-cart').attr('data-precio',(su_precio+precio).toFixed(2));
        $('#precio-producto').html($('#add-to-cart').attr('data-precio')+' €');
        
    }
    
    if (suma>=min) {
        elemForzoso.html('<i class="icon f7-icons text-color-green icon_menu" style="float: right">checkmark_circle_fill</i>');
        
    }
    else {
        elemForzoso.html('<i class="icon f7-icons text-color-red icon_menu" style="float: right">xmark</i>');
    }
    
    verificaCuantosPuestos();
    //console.log(datos[2]);
}

function verificaCuantosPuestos(){
    //elem-menu-opc elem-menu-opc-4-0 0-2 1-3
        var suma=0;
    var chk=0;
    $('.icon_menu').each(function(){
        suma++;
        if ($(this).hasClass('text-color-green')){
            chk++;
        }
            
    });

    if(suma==chk){
    //var forzosos =parseInt($('input:hidden[name=forzoso]').val());
    
    
    //if (forzosos==0){
        $('#add-to-cart').removeClass('disabled');
        $('#add-to-cart').addClass('button-fill');
        //addCarritoMenu(this);"
        document.getElementById('add-to-cart').setAttribute('onclick','addCarritoMenu(this)');
    }
    else {
        $('#add-to-cart').addClass('disabled');
        $('#add-to-cart').removeClass('button-fill');
    }
}


function addCarritoMenu(e){

    var id=e.getAttribute('data-id');
    var nombre=e.getAttribute('data-nombre');
    var precio=e.getAttribute('data-precio');
    var precio_sin=e.getAttribute('data-sin');
    var iva=e.getAttribute('data-iva');
    var img=e.getAttribute('data-img');
    var mod=e.getAttribute('data-modificadores');
    var cat=e.getAttribute('data-categoria');
    var comentario=$('#comentario-prod').val();
    var contenido='';
    var elementos=0;
    
    
    for (var x=0;x<reglamaximo.length;x++) {
        if (reglamaximo[x]['tipo']==1){
            if (id==reglamaximo[x]['id']){
               if ((reglamaximo[x]['cantidad']+1)>reglamaximo[x]['max']) {
                  //error 
                   app.dialog.alert('El máximo de <b>'+reglamaximo[x]['nombre']+'</b> para el carro es de <b>'+reglamaximo[x]['max']+'</b>.<br>Hay <b>'+reglamaximo[x]['cantidad']+ '</b> en el carro.');
                   return;
               }
               reglamaximo[x]['cantidad']+=1;
               
                
            }
        }
        else {
            if (cat==reglamaximo[x]['id']){
               if ((reglamaximo[x]['cantidad']+1)>reglamaximo[x]['max']) {
                  //error 
                   
                   app.dialog.alert('El máximo de <b>'+reglamaximo[x]['nombre']+'</b> para el carro es de <b>'+reglamaximo[x]['max']+'</b>.<br>Hay <b>'+reglamaximo[x]['cantidad']+ '</b> en el carro.');
                   return;
               }
               reglamaximo[x]['cantidad']+=1; 
            }
        }
        
    }
    
    //console.log(reglamaximo);
    
    for (var x=0;x<carrito.length;x++) {
        elementos+=carrito[x]['cantidad'];
        
        
    }
    
    if ((elementos+1)>maximocarrito){
        app.dialog.alert('El máximo de artículos para el carro es de <b>'+maximocarrito+'</b> productos.<br>Hay <b>'+elementos+ '</b> en el carro.');
        return;
    }
    
    
    
    
    var elmentosMenu=Array();
    $('.elem-menu-opc').each(function(){
        if ($(this).attr('type')=='text'){
            if (parseInt($(this).val())>0){
                contenido=$(this).attr('data-contenido');
                //console.log(contenido);
                var datos=contenido.split("#");
                elmentosMenu.push({id:datos[2],nombre:datos[3],precio:datos[7] ,cantidad:parseInt($(this).val()) ,iva:datos[9] ,img:datos[8] ,mod:null});

            }
            
        }
        else {
            if ($(this).prop('checked')){
                contenido=$(this).val();
                
                var datos=contenido.split("#"); elmentosMenu.push({id:datos[2],nombre:datos[3],precio:datos[7] ,cantidad:1 ,iva:datos[9] ,img:datos[8] ,mod:null});
                
            }
        }

    });
    //console.log(elmentosMenu);
    carrito.push({id:$('#add-to-cart').attr('data-id'),nombre:nombre ,precio:precio,  precio_sin:precio_sin, cantidad:1,iva:$('#add-to-cart').attr('data-iva'),img:img,mod:null, comentario:comentario,menu:1,elmentosMenu:elmentosMenu,categoria:cat});
        
        
        //precio+=total;
        //console.log(carrito);
        
        
        $('#add-to-cart').hide();
        $('.toolbar-bottom').show();
        
        var cart = $('.i-carrito');
        var imgtodrag = $("#img-prod");
        var eltoDrag = $("#img-prod");
        var target=$('.i-carrito');
        
        var imgclone = eltoDrag.clone()
                .offset({
                top: eltoDrag.offset().top,
                left: eltoDrag.offset().left
            })
                .css({
                    'opacity': '0.7',
                    'position': 'absolute',
                    'height': eltoDrag.height() /2,
                    'width': eltoDrag.width() /2,
                    'z-index': '999999'
                    //,'border-radius':'50%'
            })
                .appendTo($('#app'))
                .animate({
                    'top': target.offset().top - 10,
                    'left': target.offset().left - 15,
                    'height': eltoDrag.height() /3,
                    'width': eltoDrag.width() /3
            }, 1000);
            
        imgclone.animate({
            'width': 0,
            'height': 0
        }, function () {
            $(this).detach()
        });
        var href = $('#link-volver-producto').attr('href');
        setTimeout(function(){
            calcularTotal();
            guardarCarritoEnLocalStorage();
            renderizarCarrito();
            eval(href);
        }, 1500);
    
    
}

function addCarritoMenu_(e){
    var id=e.getAttribute('data-id');
    var nombre=e.getAttribute('data-nombre');
    var precio=e.getAttribute('data-precio');
    var iva=e.getAttribute('data-iva');
    var img=e.getAttribute('data-img');
    var mod=e.getAttribute('data-modificadores');
    
    var comentario=$('#comentario-prod').val();
    var elementos=0;
    var validos=0;
    var precio_a_sumar=cambiapreciosMenu();
    
    $('.input-menu-'+id).each(function(){
        var myArray = $(this).val().split("-");
        if (myArray[1]=='si'){
            validos++;
        }
        if (Array.isArray(elemMenu[myArray[0]])){
            for(j=0;j<elemMenu[myArray[0]].length;j++){
                precio_a_sumar+=(parseFloat(elemMenu[myArray[0]][j]['cantidad'])*parseFloat(elemMenu[myArray[0]][j]['precio']));
            }
        }
        else {
            
        }
        //console.log('valor:'+$(this).val());
        elementos+=1;
        
    });
    var precio_a_sumar=cambiapreciosMenu();
    if (validos == elementos){
        //todo ok 
        var cantidad=parseInt($('#cantidadProducto').val()); 
        
        //console.log(elemMenu);
        
        var img=$('#add-to-cart').attr('data-img');
        var elmentMenu=Math.floor(Math.random() * Date.now()).toString(16);
        var nombre=$('#add-to-cart').attr('data-nombre');
        var extras='';
        var precio=parseFloat($('#add-to-cart').attr('data-precio'));
        var precio_sin=parseFloat($('#add-to-cart').attr('data-sin'));
       //$('#add-to-cart').attr('data-id') 
        var elmentosMenu=Array();
        var total=0;
        $('.input-menu-'+id).each(function(){
            var myArray = $(this).val().split("-");
            //var total=0;
            if (Array.isArray(elemMenu[myArray[0]])){
                //console.log('Elemento array');
                //console.log(elemMenu[myArray[0]]);
                for(j=0;j<elemMenu[myArray[0]].length;j++){
                    
                    elmentosMenu.push({id:elemMenu[myArray[0]][j]['idproducto'],nombre:elemMenu[myArray[0]][j]['nombreproducto'] ,precio:elemMenu[myArray[0]][j]['precio'] ,cantidad:cantidad*elemMenu[myArray[0]][j]['cantidad'] ,iva:elemMenu[myArray[0]][j]['iva'] ,img:elemMenu[myArray[0]][j]['imagen'] ,mod:null});
                    total+=(parseFloat(elemMenu[myArray[0]][j]['cantidad'])*parseFloat(elemMenu[myArray[0]][j]['precio']));
                }
            }
            else {
                //console.log('Elemento simple');
                //console.log(elemMenu[myArray[0]]);
                elmentosMenu.push({id:elemMenu[myArray[0]]['idproducto'],nombre:elemMenu[myArray[0]]['nombreproducto'] ,precio:elemMenu[myArray[0]]['precio'] ,cantidad:cantidad*elemMenu[myArray[0]]['cantidad'] ,iva:elemMenu[myArray[0]]['iva'] ,img:elemMenu[myArray[0]]['imagen']  ,mod:null});
                total+=(parseFloat(elemMenu[myArray[0]]['cantidad'])*parseFloat(elemMenu[myArray[0]]['precio']));
            }
            
        });

        precio+=total;
        
        
        carrito.push({id:$('#add-to-cart').attr('data-id'),nombre:nombre ,precio:precio,  precio_sin:precio_sin, cantidad:cantidad,iva:$('#add-to-cart').attr('data-iva'),img:img,mod:null, comentario:comentario,menu:1,elmentosMenu:elmentosMenu});
        
        
        //precio+=total;
        //console.log(carrito);
        
        
        $('#add-to-cart').hide();
        $('.toolbar-bottom').show();
        
        var cart = $('.i-carrito');
        var imgtodrag = $("#img-prod");
        var eltoDrag = $("#img-prod");
        var target=$('.i-carrito');
        
        var imgclone = eltoDrag.clone()
                .offset({
                top: eltoDrag.offset().top,
                left: eltoDrag.offset().left
            })
                .css({
                    'opacity': '0.7',
                    'position': 'absolute',
                    'height': eltoDrag.height() /2,
                    'width': eltoDrag.width() /2,
                    'z-index': '999999'
                    //,'border-radius':'50%'
            })
                .appendTo($('#app'))
                .animate({
                    'top': target.offset().top - 10,
                    'left': target.offset().left - 15,
                    'height': eltoDrag.height() /3,
                    'width': eltoDrag.width() /3
            }, 1000);
            
        imgclone.animate({
            'width': 0,
            'height': 0
        }, function () {
            $(this).detach()
        });
        var href = $('#link-volver-producto').attr('href');
        setTimeout(function(){
            calcularTotal();
            guardarCarritoEnLocalStorage();
            renderizarCarrito();
            eval(href);
        }, 1500);
        
        
        
        
        //precio=precio+precio_a_sumar;

        
        
        /*
        var anchobadage=$('.badage-cart').css('width');
        var leftbadage=$('.badage-cart').css('left');
        var altobadage=$('.badage-cart').css('height');
        var sizebadage=$('.badage-cart').css('font-size');
        var pesobadage=$('.badage-cart').css('font-weight');
        var textobadage=$('.badage-cart').html();

        
        app.popover.open('.popover-cart');
        $('.popover-cart').css('top','initial');
        $('.popover-cart').css('left','initial');

        setTimeout(function(){
            app.popover.close();
        }, 2000);  
        */
        
        
        cancelarcompra2();        
        
        
        

    }
    else {
        app.dialog.alert('Complete las opciones del menú');
    }
    //console.log('elementos:'+elementos)
    
}