/**
 * Archivo: app.js
 *
 * Version: 1.0.4
 * Fecha  : 23/01/2024
 *
 * © Manuel Sánchez (www.elmaestroweb.es)
 *
*/


var $=Dom7,device=Framework7.getDevice(),isApp=!1,app_version="2.00",colorprimario="",colorsecundario="",modooscuro=0,fidelizacion=0,por_fidelizacion=0,breadcrumbs=0,tiempoenvio=0,cortesia=0,integracion=1,pedidominimo=0,nameBreadcum="Carta",idRedys=0,app=new Framework7({name:"Demo Revo",theme:"ios",el:"#app",buttonCancel:"Cancelar",id:"com.manuweb.clouddelivery",statusbar:{iosOverlaysWebView:!1,androidOverlaysWebView:!1,iosTextColor:"black",androidTextColor:"black"},dialog:{buttonCancel:"Cancelar"},smartSelect:{popupCloseLinkText:"Cerrar"},on:{init:function(){window.jQuery=jQuery,window.$=jQuery,leeestilos(),isApp?$("#app").show():($("#splash").show(),setTimeout(function(){if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)||window.innerWidth<=780){var e="css/addtohomescreen.min.css",t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t),e="js/addtohomescreen.min.js",(t=document.createElement("script")).setAttribute("type","text/javascript"),t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t),setTimeout(function(){addToHomescreen({startDelay:3})},2e3),$("#splash").hide(),$("#app").show()}else location.href="index2.html"},2e3)),window.history.pushState("forward",null,"./"),window.onpopstate=function(){window.history.pushState(null,null,"./")}}}}),whatsapp="",portesgratis=0,maximocarrito=0,importeportesgratis=0,portesgratismensaje=0,norepartomensaje="",tipo_seleccion_horas=0,dias_vista=0,tiendas=[];function navegar(e){var t=$("#i-menu").hasClass("custom-menu-icon"),o=e.split("-");app.panel.close(),$(".tab-link").removeClass("tab-link-active"),"#view-catalog"==e?(t&&$(".custom-menu-icon").css("background-color",colorprimario),muestragrupos()):t&&$(".custom-menu-icon").css("background-color","#979797"),$("#tab-"+o[1]).addClass("tab-link-active"),app.tab.show(e)}function leeestilos(){var e=servidor+"includes/leeestilos.php";$.ajax({type:"POST",url:e,dataType:"json",success:function(e){var t=Object(e);!0==t.valid&&(modooscuro=t.modooscuro,breadcrumbs=e.breadcrumbs,1==e.modooscuro?$("body").addClass("dark"):($(".page").css("background-color","white"),$(".toolbar-inner").css("background-color","rgba(255, 255, 255, 0.7)"),$(".navbar-inner").css("background-color","#fff")),app.setColorTheme(e.primario),colorprimario=e.primario,colorsecundario=e.secundario,$(".secundario").css("color",colorsecundario),$(".secundario-BG").css("background-color",colorsecundario),$(".badge").css("background-color",colorsecundario),1==t.estilo_boton_inicio?$("#i-inicio").html("house_fill"):$("#i-inicio").html("house_alt_fill"),0==t.estilo_boton_menu?($("#i-menu").html(""),$("#i-menu").removeClass("material-icons"),$("#i-menu").addClass("custom-menu-icon"),1==t.tam_boton_menu?($("#i-menu").css("width","28px"),$("#i-menu").css("height","28px"),$("#i-menu").css("bottom","0")):($("#i-menu").css("width","48px"),$("#i-menu").css("height","48px"),$("#i-menu").css("bottom","10px"),$("#boton_menu").css("bottom","9px"))):(1==t.tam_boton_menu?($("#i-menu").css("font-size","28px"),$("#i-menu").css("bottom","0")):($("#i-menu").css("font-size","48px"),$("#i-menu").css("bottom","10px")),1==t.estilo_boton_menu?$("#i-menu").html("restaurant"):2==t.estilo_boton_menu?$("#i-menu").html("room_service"):$("#i-menu").html("fastfood")),1==t.estilo_boton_carrito?($("#i-carrito").html('<span class="badge badage-cart">4</span>shopping_cart'),$("#i-carrito").removeClass("f7-icons"),$("#i-carrito").addClass("material-icons")):($("#i-carrito").html('<span class="badge  badage-cart">4</span>cart_fill'),$("#i-carrito").removeClass("material-icons"),$("#i-carrito").addClass("f7-icons")),$("input[name=tipo-boton-inicio]").each(function(){$(this).val()==t.estilo_boton_inicio&&$(this).prop("checked",!0)}),$("input[name=tipo-boton-menu]").each(function(){$(this).val()==t.estilo_boton_menu&&$(this).prop("checked",!0)}),$("input[name=tipo-boton-carrito]").each(function(){$(this).val()==t.estilo_boton_carrito&&$(this).prop("checked",!0)}),$("input[name=tam-boton-menu]").each(function(){$(this).val()==t.tam_boton_menu&&$(this).prop("checked",!0)}),"standalone"in window.navigator&&window.navigator.standalone&&$("#tool-bar-menu-icon").css("bottom","15px"),$("#span-inicio").html(t.boton_inicio),$("#boton_menu").html(t.boton_menu),nameBreadcum=t.boton_menu,$("#span-carrito").html(t.boton_carrito))}})}function muestranosotros(){app.tab.show("#view-nosotros")}function leeEstaoWeb(){var e=servidor+"includes/leeestadoweb.php";$.ajax({type:"POST",url:e,dataType:"json",success:function(e){var t=Object(e);if(!0==t.valid){norepartomensaje=t.norepartomensaje,portesgratis=t.portesgratis,importeportesgratis=t.importeportesgratis,portesgratismensaje=t.portesgratismensaje,maximocarrito=t.maximocarrito,whatsapp=t.movil,idRedsys=t.idRedsys,tipo_seleccion_horas=t.tipo_seleccion_horas,dias_vista=t.dias_vista;var o=t.nombre_comercial;if(app.name=o,app.dialog.title=o,document.title=o,Array.isArray(t.alias)){for(x=0;x<t.alias.length;x++)tiendas.push({id:t.id[x],alias:t.alias[x],domicilio:t.domicilio[x],telefono:t.telefono[x],lat:t.lat[x],lng:t.lng[x],distancia:0});t.alias.length>0&&(void 0==window.localStorage.getItem("miPos")?app.dialog.confirm("Para poder ofrecerle el restaurante m\xe1s cercano vamos a solicitar su posici\xf3n.","\xa1Atenci\xf3n!",function(){funcionInitPos()},function(){}):funcionInitPos())}if(0==t.on)fidelizacion=t.fidelizacion,window.localStorage.setItem("porcentaje_fidelizacion",encripta(t.porcentaje)),por_fidelizacion=t.porcentaje,0==fidelizacion&&(por_fidelizacion=0,window.localStorage.setItem("porcentaje_fidelizacion",encripta(0))),tiempoenvio=t.tiempoenvio,cortesia=parseInt(t.cortesia),integracion=t.integracion,pedidominimo=t.pedidominimo,cargainicio();else{var a='<div class="text-align-center"><img src="img/mantenimiento.png" width="90%" height="auto"></div>';$("#pagina-inicio").html(a),$("#view-carrito .page-content").html(a),$("#view-catalog .page-content").html(a),$("#buscador-productos").hide(),$("#view-usuario .page-content").html(a)}}else console.log("ERROR Estado Web")},error:function(e,t,o){console.log(e.status),console.log(o)}})}function carganosotros(){$.ajax({type:"POST",url:servidor+"includes/leenosotros.php",dataType:"json",data:{isapp:isApp},success:function(e){var t=Object(e);if(!0==t.valid){var o=t.tipo,a=t.texto,s=t.id,n="";for(x=0;x<s.length;x++){if("1"==o[x]&&(n=n+"<div>"+a[x]+"</div>"),"2"==o[x]){var r=servidor+"js_out/"+a[x]+"?v="+Date.now(),c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",r),void 0!==c&&document.getElementsByTagName("body")[0].appendChild(c)}if("3"==o[x]){var r=servidor+"css_out/"+a[x]+"?v="+Date.now(),c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",r),void 0!==c&&document.getElementsByTagName("body")[0].appendChild(c)}if("4"==o[x]){var l=[],d=[],p=[],u=a[x].split("||");for(i=0;i<u.length-1;i++)l[i]=u[i].split("##");for(i=0;i<l.length;i++)d[i]=servidor+"img/upload/"+l[i][0],p[i]=l[i][1];n+=new imagenesInicio(d,p).contenido(0)}}$("#nosotros-page").html(n)}else $("#contenedor-nosotros").html("Error leyendo p\xe1gina nosotros")}})}function cargainicio(){$.ajax({type:"POST",url:servidor+"includes/leeinicio.php",dataType:"json",data:{isapp:isApp},success:function(e){var t=Object(e);if(!0==t.valid){var o=t.tipo,a=t.texto,s=t.id,n="";for(x=0;x<s.length;x++){if("1"==o[x]&&(n=n+"<div>"+a[x]+"</div>"),"2"==o[x]){var r=servidor+"js_out/"+a[x]+"?v="+Date.now(),c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",r),void 0!==c&&document.getElementsByTagName("body")[0].appendChild(c)}if("3"==o[x]){var r=servidor+"css_out/"+a[x]+"?v="+Date.now(),c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",r),void 0!==c&&document.getElementsByTagName("body")[0].appendChild(c)}if("5"==o[x]&&(n=n+'<div class="marquee"><div class="marquee-text">'+a[x]+"</div></div>"),"4"==o[x]){var l=[],d=[],p=[],u=a[x].split("||");for(i=0;i<u.length-1;i++)l[i]=u[i].split("##");for(i=0;i<l.length;i++)d[i]=servidor+"img/upload/"+l[i][0],p[i]=l[i][1];n+=new imagenesInicio(d,p).contenido(0)}}$("#pagina-inicio").html(n),destacadosinicio()}else $("#contenedor-inicio").html("Error leyendo p\xe1gina de inicio")},error:function(e,t,o){console.log(e.status),console.log(o)}})}function destacadosinicio(e="pagina-inicio",t="inicio"){var o=servidor+"includes/leedestacados.php";$.ajax({type:"POST",url:o,dataType:"json",data:{sitio:t},success:function(t){var o=Object(t);if(!0==o.valid&&null!=o.id&&0==$("#prod-destacados-"+e).length&&o.id.length>0){$("#"+e).prepend("<p class='block-title'>Destacados</p><div id='prod-destacados-"+e+"'></div>");var a=o.id,s=o.producto,n=o.nombre,r=o.cat,c=o.gru,l=o.idcat,d=o.idgru,p=o.imagen,u='<div class="swiper" style="display: flex;justify-content: center;align-items: center;"><div class="swiper-pagination"></div><div class="swiper-wrapper">';for(x=0;x<a.length;x++){var m="'"+s[x]+"','"+n[x]+"','"+d[x]+"','"+c[x]+"','"+l[x]+"','"+r[x]+"',' ',0",g="";g=c[x]==r[x]?c[x]:c[x]+" - "+r[x],u+='<div class="swiper-slide" onclick="navegar(\'#view-catalog\');muestraelproducto('+m+');"><img src="'+p[x]+'" width="200px" height="auto" style="border-radius:10px;"><br><span style="color: '+colorprimario+';" >'+n[x]+'</span><br><span style="color: '+colorsecundario+'; font-size: 11px;">'+g+"</span></div>"}u+="</div></div><br>",$("#prod-destacados-"+e).html(u),app.swiper.create(".swiper",{allowTouchMove:!0,spaceBetween:10,width:205,autoplay:{delay:3e3}})}},error:function(e,t,o){console.log(e.status),console.log(o)}})}$("#version-app").html(app_version),leeEstaoWeb(),carganosotros();var w=screen.width,h=screen.height,htpv=$("#content-tpv").css("height"),htool=$("#tool-bar").css("height"),hnav=$(".navbar").css("height"),hiframe=parseInt(h)-parseInt(hnav);function leetexto(e,t){$.ajax({url:servidor+"includes/leetexto.php",data:{archivo:t},method:"post",dataType:"json",success:function(t){var o=Object(t);!0==o.valid?muestraAviso(e,o.lineas):(console.log(o.valid),app.dialog.alert("No se pudo leer "+e))}})}function muestraAviso(e,t){for(var o="",a=0;a<t.length;a++)o+=t[a];var s=app.popup.create({content:'<div class="popup"><div class="block page-content"><p class="text-align-left"><a href="javascript:cierraEstePop();" class="link popup-close"><i class="icon f7-icons ">xmark</i></a></p> <div class="block-title block-title-medium">'+e+'</div><div class="block">'+o+"<br></div></div></div>",on:{open:function(e){},opened:function(e){}}});s.on("close",function(e){}),s.on("closed",function(e){}),s.open()}function muestraMensaje(e,t="",o="",a="",s=4e3){""==t&&(t=app.name),""!=a&&(e+='<br><br><div style="text-align:center;"><img src="'+servidor+"/img/upload/"+a+'" width="90%" height="auto"></div>'),app.notification.create({text:e,icon:'<img src="img/icon.png">',title:t,subtitle:o,titleRightText:"ahora",closeTimeout:s,on:{opened:function(){}}}).open()}function cierraEstePop(){app.popup.close()}$("#iframe_tpv").css("height",hiframe+"px"),window.onmessage=function(e){myTimeoutTarjetaActivo="no";var t=e.data.split("###"),o=t[0],a=t[1];t[2];var s=t[3];navegar("#view-catalog"),app.toolbar.show(".toolbar-bottom"),$("page").css("padding-bottom","70px"),"OK"==a?(muestraMensaje("Pedido "+s+" pagado correctamente",titulo="",subtitulo="Pago tarjeta","pedido-pagado.jpg",tiempo=5e3),borradatoscompra()):app.dialog.alert("Pedido "+s+" NO se pag\xf3 y se ha cancelado",function(){cancelaPedido(o),$(".subnavbar").show(),$("#search").show(),$(".toolbar-bottom").show(),$("#boton-menu-principal").show(),navegar("#view-catalog")})};class imagenesInicio{constructor(e,t){this.img=e,this.prod=t,this.indice=1,this.elem=makeid(5),this.indice>=this.img.length&&(this.indice=0),setInterval(this.cambiaimg.bind(this),5e3)}contenido(e){return'<div style="text-align:center;"><img class="imagen imagen-inicio" id="imgInicio'+this.elem+'" data="'+this.prod[e]+'" src="'+this.img[e]+'" width="100%" height="auto" onclick="clicenImgInicio(this);"></div>'}cambiaimg(){$("#imgInicio"+this.elem).attr("src",this.img[this.indice]),$("#imgInicio"+this.elem).attr("data",this.prod[this.indice]),this.indice++,this.indice>=this.img.length&&(this.indice=0)}}function makeid(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=o.length,s=0;s<e;s++)t+=o.charAt(Math.floor(Math.random()*a));return t}function encripta(e){var t="",o=0,a=e.toString();do t+=app.name,o=t.length;while(o<a.length);var s=[],n=[],r="";for(x=0;x<t.length;x++)s[x]=t.charCodeAt(x);for(x=0;x<a.length;x++)n[x]=a.substr(x).charCodeAt(0);for(x=0;x<a.length;x++)x<t.length&&(r+=s[x]*n[x]+".");return r.substring(0,r.length-1)}function desencripta(e){var t="",o=0,a=e.split(".");do t+=app.name,o=t.length;while(o<a.length);var s=[],n=0,r="";for(x=0;x<t.length;x++)s[x]=t.charCodeAt(x);for(x=0;x<a.length;x++)r+=String.fromCharCode(n=a[x]/s[x]);return r}function cookieFirst(){window.localStorage.setItem("cookiePrimera","si");var e="App";!1==isApp&&(e="Web");var t='<div class="grid grid-cols-3 grid-gap"><div class=""><span style="font-size:1.2em;">Esta '+e+' <b>NO</b> usa cookies.</span></div><div class=""><button class="button button-fill button-round toast-close">Entendido</button></div><div class=""><button class="button button-outline button-round saber-cookies toast-close">Saber m\xe1s</button></div></div>';$("#cookie-first").html(t),$("#cookie-first").show(),$(".toast-close").on("click",function(){$("#cookie-first").hide()}),$(".saber-cookies").on("click",function(){var t='<div class="popup"><div class="page-content"><div class="block"><p style="font-size:1.2em;">Esta '+e+' <b>NO</b> usa cookies.</p><p style="font-size:1.2em;">La tecnolog\xeda usada es <b>localStorage</b>. localStorage se guarda en el dispositivo y no puede ser leido por nadie m\xe1s que esta '+e+', es m\xe1s seguro y r\xe1pido que las cookies convencionales.</p><p style="font-size:1.2em;">Se usa para guardar tus preferencias de uso de esta '+e+' como puede ser los datos del carrito, tus datos de usuarios y otros elementos. </p><p style="font-size:1.2em;"><b>localStorage</b> se elimina al borrar esta '+e+'. </p><div style="width: 50%;margin:auto;"><button class="button button-fill button-round ink popup-close">Entendido</button></div></div></div></div>';app.popup.create({content:t}).open()})}const funcionInitPos=()=>{if("geolocation"in navigator){let e=e=>{localStorage.setItem("miPos","ok"),localStorage.setItem("miPosLat",e.coords.latitude),localStorage.setItem("miPosLng",e.coords.longitude)},t=e=>{console.log("Error obteniendo ubicaci\xf3n: ",e),localStorage.setItem("miPos","ko")},o={enableHighAccuracy:!0,maximumAge:500,timeout:5e3};navigator.geolocation.getCurrentPosition(e,t,o)}},gradosARadianes=e=>e*Math.PI/180,calcularDistanciaEntreDosCoordenadas=(e,t,o,a)=>{e=gradosARadianes(e),t=gradosARadianes(t),o=gradosARadianes(o),a=gradosARadianes(a);let s=Math.pow(Math.sin((o-e)/2),2)+Math.cos(e)*Math.cos(o)*Math.pow(Math.sin((a-t)/2),2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))};function clicenImgInicio(e){var t=$(e).attr("data");""!=t&&(navegar("#view-catalog"),muestraproductoinicio(t))}



